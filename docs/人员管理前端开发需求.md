# 人员管理前端开发需求

## 概述
人员管理模块前端负责提供用户界面，用于管理学校系统中的所有人员信息，包括学生、教职工、家长，以及相关的班级和部门组织。前端需要与后端API进行交互，提供直观、易用的操作界面。

**技术栈**：
- 前端框架：Vue 3 + TypeScript
- UI组件库：Element Plus
- 状态管理：Pinia（可选，当前使用响应式API）
- 构建工具：Vite
- HTTP客户端：Axios

---

## 一、API接口调用

### 1.1 人员管理API (`/api/persons`)

#### 1.1.1 获取人员列表
**接口**：`GET /api/persons`
**参数**：
```typescript
interface PersonQuery {
  page?: number;      // 页码，从1开始，默认1
  limit?: number;     // 每页条数，默认20
  type?: string;      // 人员类型：student/teacher/parent
  search?: string;    // 搜索关键字（姓名、学号、工号）
  class_id?: string;  // 班级ID（仅当type=student时有效）
  department_id?: string; // 部门ID（仅当type=teacher时有效）
}
```

**响应**：
```typescript
interface ListResponse<T> {
  items: T[];         // 人员列表
  total: number;      // 总记录数
  page: number;       // 当前页码
  limit: number;      // 每页条数
}

type PersonResponse = StudentResponse | TeacherResponse | ParentResponse;
```

#### 1.1.2 获取单个人员
**接口**：`GET /api/persons/{id}`
**响应**：`PersonResponse`

#### 1.1.3 创建人员
**接口**：`POST /api/persons`
**请求体**：
```typescript
interface PersonCreate {
  name: string;           // 姓名，必填
  gender: number;         // 性别：0-未知，1-男，2-女，必填
  type_: string;          // 类型：student/teacher/parent，必填
  birthday?: string;      // 生日（YYYY-MM-DD格式）
  phone?: string;         // 电话
  email?: string;         // 邮箱
  
  // 学生特定字段（当type_='student'时必填）
  student_no?: string;    // 学号
  class_id?: string;      // 班级ID
  enrollment_date?: string; // 入学日期
  
  // 教师特定字段（当type_='teacher'时必填）
  employee_no?: string;   // 工号
  department_id?: string; // 部门ID
  title?: string;         // 职称
  hire_date?: string;     // 入职日期
  
  // 家长特定字段
  wechat_openid?: string; // 微信OpenID
  occupation?: string;    // 职业
}
```

#### 1.1.4 更新人员
**接口**：`PUT /api/persons/{id}`
**请求体**：`PersonUpdate`（字段可选，只更新提供的字段）

#### 1.1.5 删除人员
**接口**：`DELETE /api/persons/{id}`

### 1.2 班级管理API (`/api/classes`)

#### 1.2.1 获取班级列表
**接口**：`GET /api/classes`
**参数**：
```typescript
interface ClassQuery {
  page?: number;      // 页码
  limit?: number;     // 每页条数
  search?: string;    // 搜索关键字（班级名称）
  grade?: number;     // 年级筛选
}
```

#### 1.2.2 创建/更新/删除班级
- `POST /api/classes`：创建班级
- `PUT /api/classes/{id}`：更新班级
- `DELETE /api/classes/{id}`：删除班级

### 1.3 部门管理API (`/api/departments`)

#### 1.3.1 获取部门列表
**接口**：`GET /api/departments`
**参数**：
```typescript
interface DepartmentQuery {
  page?: number;      // 页码
  limit?: number;     // 每页条数
  search?: string;    // 搜索关键字（部门名称）
}
```

#### 1.3.2 创建/更新/删除部门
- `POST /api/departments`：创建部门
- `PUT /api/departments/{id}`：更新部门
- `DELETE /api/departments/{id}`：删除部门

---

## 二、基础功能需求

### 2.1 人员列表页面 (`PersonView.vue`)

#### 2.1.1 搜索功能
- **多条件搜索**：支持按姓名、学号/工号模糊搜索
- **类型筛选**：学生/教师/家长类型筛选
- **关联筛选**：按班级筛选学生，按部门筛选教师
- **防抖处理**：搜索输入防抖（500ms）

#### 2.1.2 表格展示
- **分页显示**：支持每页10/20/50/100条数据
- **多列显示**：
  - ID（可选显示）
  - 姓名
  - 类型（学生/教师/家长）
  - 编号（学号/工号）
  - 所属（班级/部门）
  - 电话
  - 邮箱
  - 创建时间
- **类型标识**：不同类型使用不同颜色或图标标识
- **操作列**：编辑、删除按钮

#### 2.1.3 操作按钮
- **新增人员**：打开新增对话框
- **批量导入**：Excel文件导入（待实现）
- **批量导出**：导出当前搜索结果到Excel（待实现）
- **刷新列表**：重新加载数据

### 2.2 人员表单组件 (`PersonForm.vue`)

#### 2.2.1 动态表单
- **基础信息**：姓名、性别、类型、电话、邮箱、生日
- **类型相关字段**：
  - **学生**：学号（必填）、班级选择、入学日期
  - **教师**：工号（必填）、部门选择、职称、入职日期
  - **家长**：职业、微信OpenID

#### 2.2.2 表单验证
- **前端验证**：
  - 必填字段验证
  - 格式验证（邮箱、电话）
  - 类型相关字段验证（学号/工号必填）
- **后端验证反馈**：显示后端返回的错误信息

#### 2.2.3 数据加载
- **班级列表**：异步加载班级列表供选择
- **部门列表**：异步加载部门列表供选择
- **编辑回填**：编辑时自动填充表单数据

### 2.3 班级管理页面 (`ClassView.vue`)

#### 2.3.1 班级列表
- **搜索功能**：按班级名称、年级搜索
- **表格展示**：班级名称、年级、班主任、学年、创建时间
- **操作功能**：新增、编辑、删除班级

#### 2.3.2 班级表单
- **表单字段**：班级名称、年级、班主任（可选）、学年
- **班主任选择**：从教师列表中选取

### 2.4 部门管理页面 (`DepartmentView.vue`)

#### 2.4.1 部门列表
- **树形结构**：展示部门层级关系
- **搜索功能**：按部门名称搜索
- **操作功能**：新增、编辑、删除部门

#### 2.4.2 部门表单
- **表单字段**：部门名称、上级部门（可选）
- **上级部门选择**：从现有部门中选择

---

## 三、组件设计要求

### 3.1 通用组件

#### 3.1.1 搜索表单组件 (`SearchForm.vue`)
- **可配置字段**：支持动态添加搜索条件
- **布局优化**：响应式布局，适配不同屏幕
- **操作按钮**：搜索、重置按钮

#### 3.1.2 数据表格组件 (`DataTable.vue`)
- **分页集成**：集成分页功能
- **排序功能**：支持列排序
- **加载状态**：显示加载动画
- **空状态**：无数据时的提示

#### 3.1.3 操作按钮组 (`ActionButtons.vue`)
- **权限控制**：根据权限显示不同按钮
- **批量操作**：支持选中多行进行批量操作
- **确认提示**：删除等危险操作需要确认

### 3.2 业务组件

#### 3.2.1 人员类型选择器 (`PersonTypeSelector.vue`)
- **类型切换**：学生/教师/家长切换
- **联动效果**：切换类型时显示不同的附加字段
- **图标标识**：不同类型使用不同图标

#### 3.2.2 班级选择器 (`ClassSelector.vue`)
- **异步加载**：远程搜索班级
- **分页加载**：支持大量班级数据
- **缓存机制**：已加载数据缓存

#### 3.2.3 部门选择器 (`DepartmentSelector.vue`)
- **树形选择**：部门树形结构选择
- **异步加载**：按需加载部门树节点
- **多选支持**：可选支持多选

---

## 四、事件按钮策划

### 4.1 人员列表页面按钮

#### 4.1.1 主要操作按钮
- **新增人员按钮**
  - 位置：页面右上角
  - 样式：主按钮（蓝色背景，白色文字）
  - 图标：`el-icon-plus`
  - 事件：打开新增人员对话框
  - 权限：管理员、教务处

- **批量导入按钮**
  - 位置：新增按钮右侧
  - 样式：次要按钮（浅色背景，蓝色文字）
  - 图标：`el-icon-upload`
  - 事件：打开Excel导入对话框
  - 权限：管理员、教务处

- **批量导出按钮**
  - 位置：导入按钮右侧
  - 样式：次要按钮（浅色背景，蓝色文字）
  - 图标：`el-icon-download`
  - 事件：导出当前搜索结果到Excel
  - 权限：所有登录用户

- **刷新按钮**
  - 位置：搜索表单右侧
  - 样式：文本按钮（无背景，蓝色文字）
  - 图标：`el-icon-refresh`
  - 事件：重新加载人员列表
  - 状态：点击后显示加载状态

#### 4.1.2 表格操作按钮（每行）
- **编辑按钮**
  - 位置：操作列第一个按钮
  - 样式：链接按钮（蓝色文字，无边框）
  - 图标：`el-icon-edit`
  - 事件：打开编辑对话框，填充当前行数据
  - 权限：管理员、教务处、班主任（仅限本班学生）

- **删除按钮**
  - 位置：操作列第二个按钮
  - 样式：危险按钮（红色文字，无边框）
  - 图标：`el-icon-delete`
  - 事件：弹出确认对话框，确认后删除
  - 权限：管理员、教务处

#### 4.1.3 批量操作按钮组
- **批量删除按钮**
  - 显示条件：当选中多行时显示
  - 位置：表格上方操作栏
  - 样式：危险按钮（红色背景，白色文字）
  - 图标：`el-icon-delete`
  - 事件：批量删除选中人员
  - 权限：管理员、教务处

- **批量分配班级**（仅对学生）
  - 显示条件：选中学生类型人员时显示
  - 样式：次要按钮（浅色背景，蓝色文字）
  - 图标：`el-icon-s-check`
  - 事件：打开批量分配班级对话框
  - 权限：管理员、教务处

### 4.2 人员表单对话框按钮

#### 4.2.1 表单操作按钮
- **保存按钮**
  - 位置：表单底部右侧
  - 样式：主按钮（蓝色背景，白色文字）
  - 图标：`el-icon-check`
  - 事件：表单验证，提交数据
  - 状态：提交时显示加载状态，禁用按钮

- **取消按钮**
  - 位置：保存按钮左侧
  - 样式：文本按钮（无背景，灰色文字）
  - 图标：无
  - 事件：关闭对话框，不保存
  - 状态：点击后立即关闭

- **重置按钮**
  - 位置：取消按钮左侧（仅在新增表单显示）
  - 样式：文本按钮（无背景，蓝色文字）
  - 图标：`el-icon-refresh-left`
  - 事件：重置表单到初始状态
  - 状态：不影响已填写的必填项

### 4.3 导入导出对话框按钮

#### 4.3.1 导入对话框按钮
- **选择文件按钮**
  - 样式：主按钮（蓝色背景，白色文字）
  - 图标：`el-icon-folder-opened`
  - 事件：打开文件选择器

- **上传按钮**
  - 样式：主按钮（绿色背景，白色文字）
  - 图标：`el-icon-upload2`
  - 事件：开始上传并解析Excel
  - 状态：上传时显示进度条

- **下载模板按钮**
  - 样式：链接按钮（蓝色文字，无边框）
  - 图标：`el-icon-download`
  - 事件：下载标准导入模板Excel

#### 4.3.2 导出对话框按钮
- **导出按钮**
  - 样式：主按钮（蓝色背景，白色文字）
  - 图标：`el-icon-download`
  - 事件：开始导出数据
  - 状态：导出时显示进度

- **选择字段按钮**
  - 样式：次要按钮（浅色背景，蓝色文字）
  - 图标：`el-icon-s-grid`
  - 事件：打开字段选择对话框

### 4.4 搜索表单按钮

#### 4.4.1 搜索按钮
- **搜索按钮**
  - 样式：主按钮（蓝色背景，白色文字）
  - 图标：`el-icon-search`
  - 事件：执行搜索，重置到第一页
  - 状态：搜索时显示加载状态

- **重置按钮**
  - 样式：文本按钮（无背景，灰色文字）
  - 图标：`el-icon-refresh-left`
  - 事件：清空搜索条件，重新加载

- **高级搜索切换按钮**
  - 样式：链接按钮（蓝色文字，无边框）
  - 图标：`el-icon-arrow-down` / `el-icon-arrow-up`
  - 事件：展开/收起高级搜索条件

---

## 五、按钮样式规范（参考ArkUI设计）

### 5.1 设计原则
- **一致性**：相同功能的按钮使用相同样式
- **可辨识性**：不同重要性的操作使用不同样式
- **反馈性**：按钮状态变化提供视觉反馈
- **无障碍**：考虑色盲用户，使用图标辅助识别

### 5.2 颜色规范（参考ArkUI配色）

#### 5.2.1 主色调
- **主按钮背景色**：`#409EFF`（Element Plus 默认蓝色）
- **主按钮文字色**：`#FFFFFF`（白色）
- **主按钮悬停色**：`#66B1FF`（浅蓝色）
- **主按钮激活色**：`#3A8EE6`（深蓝色）

#### 5.2.2 次要色调
- **次要按钮背景色**：`#ECF5FF`（浅蓝色背景）
- **次要按钮文字色**：`#409EFF`（蓝色文字）
- **次要按钮边框色**：`#B3D8FF`（浅蓝色边框）

#### 5.2.3 危险色调
- **危险按钮文字色**：`#F56C6C`（红色文字）
- **危险按钮背景色**：`#FEF0F0`（浅红色背景，用于填充按钮）
- **危险按钮悬停色**：`#F78989`（浅红色）

#### 5.2.4 中性色调
- **禁用状态色**：`#C0C4CC`（灰色）
- **边框色**：`#DCDFE6`（浅灰色）
- **文字色**：`#606266`（深灰色）

### 5.3 尺寸规范

#### 5.3.1 按钮高度
- **大按钮**：40px（用于主要操作，如新增、保存）
- **中按钮**：32px（默认尺寸，用于大部分操作）
- **小按钮**：24px（用于表格操作按钮）
- **迷你按钮**：20px（用于紧凑布局）

#### 5.3.2 按钮间距
- **水平间距**：12px（按钮之间的水平距离）
- **垂直间距**：8px（按钮组之间的垂直距离）
- **内边距**：左右各20px（大按钮），左右各16px（中按钮）

### 5.4 边框与圆角
- **边框宽度**：1px（所有有边框的按钮）
- **圆角大小**：4px（统一圆角，现代化设计）
- **阴影效果**：参考ArkUI阴影样式
  ```css
  box-shadow: 0 2px 6px rgba(78, 89, 105, 0.06);
  ```

### 5.5 字体规范
- **字体家族**：`'Noto Sans SC', 'Microsoft YaHei', sans-serif`（参考ArkUI）
- **字体大小**：
  - 大按钮：14px
  - 中按钮：13px  
  - 小按钮：12px
- **字体字重**：`font-weight: 500`（中等字重，参考ArkUI）
- **图标大小**：图标与文字同高，或使用标准图标尺寸

### 5.6 状态样式

#### 5.6.1 默认状态
- 正常显示，可点击
- 颜色饱满，无透明度

#### 5.6.2 悬停状态（hover）
- 背景色变浅/变深
- 添加细微过渡动画
- 光标变为手型

#### 5.6.3 点击状态（active）
- 背景色加深
- 添加轻微内阴影
- 保持点击反馈

#### 5.6.4 禁用状态（disabled）
- 透明度：0.6
- 颜色变灰
- 不可点击，光标为禁止符号
- 移除所有交互效果

#### 5.6.5 加载状态（loading）
- 显示加载动画（旋转图标）
- 按钮文字变为"处理中..."
- 禁用点击，防止重复提交

### 5.7 按钮组合样式

#### 5.7.1 按钮组（Button Group）
- 相邻按钮共享边框，无重复边框
- 第一个按钮左侧圆角，最后一个按钮右侧圆角
- 中间按钮无左右圆角

#### 5.7.2 图标按钮（Icon Button）
- 仅显示图标，无文字
- 悬停时显示工具提示（tooltip）
- 适当减少内边距

#### 5.7.3 文字按钮（Text Button）
- 无背景，无边框
- 仅文字颜色变化表示状态
- 悬停时添加轻微背景色

### 5.8 特殊按钮样式

#### 5.8.1 下拉按钮（Dropdown Button）
- 右侧有下拉箭头图标
- 点击主区域执行默认操作
- 点击箭头显示下拉菜单

#### 5.8.2 分裂按钮（Split Button）
- 主操作区域和下拉箭头分离
- 中间有分隔线
- 分别响应不同点击区域

#### 5.8.3 浮动操作按钮（FAB）
- 圆形按钮，固定位置
- 显著阴影，突出显示
- 用于主要全局操作

---
## 七、状态管理

### 7.1 人员状态管理 (`stores/person.ts`)

```typescript
interface PersonState {
  persons: PersonResponse[];  // 人员列表
  total: number;              // 总条数
  loading: boolean;           // 加载状态
  currentQuery: PersonQuery;  // 当前查询条件
  selectedPersons: string[];  // 选中的人员ID
}

// 主要方法
const usePersonStore = defineStore('person', () => {
  // 状态
  const persons = ref<PersonResponse[]>([]);
  const total = ref(0);
  const loading = ref(false);
  const currentQuery = ref<PersonQuery>({ page: 1, limit: 20 });
  
  // 方法
  async function fetchPersons(query?: PersonQuery) {
    // 获取人员列表
  }
  
  async function createPerson(data: PersonCreate) {
    // 创建人员
  }
  
  async function updatePerson(id: string, data: PersonUpdate) {
    // 更新人员
  }
  
  async function deletePerson(id: string) {
    // 删除人员
  }
  
  // 批量操作
  async function batchDelete(ids: string[]) {
    // 批量删除
  }
  
  return { persons, total, loading, fetchPersons, createPerson, updatePerson, deletePerson };
});
```

### 7.2 班级状态管理 (`stores/class.ts`)
- 班级列表状态
- 当前查询条件
- 加载状态管理

### 7.3 部门状态管理 (`stores/department.ts`)
- 部门列表状态（树形结构）
- 当前查询条件
- 加载状态管理

---

## 八、用户体验要求

### 8.1 响应式设计
- **桌面端**：表格完整显示，操作便捷
- **平板端**：简化布局，适配中等屏幕
- **移动端**：列表式展示，操作简化

### 8.2 加载状态
- **页面加载**：显示骨架屏或加载动画
- **数据加载**：表格行显示加载状态
- **操作加载**：按钮显示加载状态，防止重复提交

### 8.3 错误处理
- **网络错误**：显示友好的错误提示
- **表单错误**：字段级错误提示
- **权限错误**：无权限操作提示

### 8.4 操作反馈
- **成功提示**：操作成功后的Toast提示
- **确认提示**：删除等危险操作前的确认对话框
- **撤销操作**：支持撤销某些操作（可选）

---

## 九、高级功能需求（待实现）

### 9.1 批量导入导出

#### 9.1.1 Excel导入
- **文件上传**：支持Excel文件上传
- **模板下载**：提供标准导入模板
- **数据预览**：上传后预览数据
- **导入结果**：显示导入成功/失败统计

#### 9.1.2 Excel导出
- **条件导出**：按当前搜索条件导出
- **字段选择**：选择导出的字段
- **格式自定义**：支持自定义导出格式

### 9.2 高级搜索

#### 9.2.1 组合搜索
- **多条件组合**：支持多个条件的AND/OR组合
- **保存搜索**：保存常用搜索条件
- **历史搜索**：记录搜索历史

#### 9.2.2 模糊搜索
- **拼音搜索**：支持拼音搜索姓名
- **相似度搜索**：使用PostgreSQL pg_trgm扩展

### 9.3 数据统计

#### 9.3.1 人员统计
- **类型分布**：学生/教师/家长数量统计
- **班级分布**：各班级学生数量统计
- **部门分布**：各部门教师数量统计

#### 9.3.2 图表展示
- **饼图**：人员类型分布
- **柱状图**：班级/部门人员分布
- **趋势图**：人员增长趋势

---

## 十、文件结构

### 10.1 现有文件
```
frontend/src/
├── api/
│   ├── index.ts          # Axios配置
│   ├── person.ts         # 人员API封装
│   ├── class.ts          # 班级API封装
│   └── department.ts     # 部门API封装
├── views/
│   └── PersonView.vue    # 人员管理主页面（已实现）
└── components/
    └── (待创建业务组件)
```

### 10.2 待创建文件

#### 10.2.1 页面文件
- `ClassView.vue`：班级管理页面
- `DepartmentView.vue`：部门管理页面

#### 10.2.2 组件文件
- `PersonForm.vue`：人员表单组件（可提取现有逻辑）
- `SearchForm.vue`：通用搜索表单组件
- `DataTable.vue`：通用数据表格组件
- `ActionButtons.vue`：操作按钮组件
- `PersonTypeSelector.vue`：人员类型选择器
- `ClassSelector.vue`：班级选择器组件
- `DepartmentSelector.vue`：部门选择器组件

#### 10.2.3 状态管理文件
- `stores/person.ts`：人员状态管理
- `stores/class.ts`：班级状态管理
- `stores/department.ts`：部门状态管理

#### 10.2.4 类型定义文件
- `types/person.ts`：人员相关类型定义（已部分存在于api/person.ts）
- `types/class.ts`：班级相关类型定义
- `types/department.ts`：部门相关类型定义

---

## 十一、开发规范

### 11.1 代码规范
- **TypeScript**：严格类型检查，避免使用any
- **组件命名**：PascalCase命名，语义化
- **文件组织**：按功能模块组织文件
- **代码注释**：复杂逻辑添加注释

### 11.2 组件设计原则
- **单一职责**：每个组件只负责一个功能
- **可复用性**：通用组件设计为可复用
- **可维护性**：组件逻辑清晰，易于维护
- **可测试性**：组件易于单元测试

### 11.3 性能优化
- **懒加载**：路由懒加载，按需加载组件
- **虚拟滚动**：大量数据时使用虚拟滚动
- **数据缓存**：频繁访问的数据进行缓存
- **请求合并**：避免重复请求，合理合并请求

### 11.4 安全考虑
- **输入验证**：所有用户输入必须验证
- **XSS防护**：防止跨站脚本攻击
- **CSRF防护**：使用CSRF Token
- **权限验证**：前端配合后端进行权限控制

---

## 十二、测试要求

### 12.1 单元测试
- **组件测试**：测试组件渲染和交互
- **工具函数测试**：测试工具函数的正确性
- **API封装测试**：测试API调用的正确性

### 12.2 集成测试
- **页面流程测试**：测试完整的操作流程
- **API集成测试**：测试前后端数据交互
- **状态管理测试**：测试状态管理逻辑

### 12.3 E2E测试
- **用户操作测试**：模拟用户完整操作流程
- **边界条件测试**：测试边界条件和异常情况
- **性能测试**：测试页面加载和操作性能

---

## 十三、验收标准

### 13.1 功能验收
- [ ] 人员管理：完整的CRUD操作，支持三种类型
- [ ] 班级管理：班级的创建、编辑、删除，分配班主任
- [ ] 部门管理：部门树形结构管理
- [ ] 搜索功能：多条件组合搜索，模糊匹配
- [ ] 分页功能：支持多种分页方式
- [ ] 表单验证：前后端完整的数据验证

### 13.2 性能验收
- [ ] 列表加载：1000条数据加载时间<2秒
- [ ] 搜索响应：搜索结果返回时间<1秒
- [ ] 表单提交：表单提交响应时间<1秒
- [ ] 内存使用：页面内存使用合理，无内存泄漏

### 13.3 用户体验验收
- [ ] 响应式设计：适配不同屏幕尺寸
- [ ] 操作流畅：无卡顿，动画流畅
- [ ] 错误提示：友好且明确的错误提示
- [ ] 加载状态：合理的加载状态提示

### 13.4 代码质量验收
- [ ] 代码规范：符合ESLint和Prettier规范
- [ ] 类型安全：TypeScript严格模式，无any类型
- [ ] 测试覆盖：关键功能测试覆盖率>80%
- [ ] 文档完整：组件文档、API文档齐全

---

## 附录

### A. 相关API文档
1. 人员管理API：`/api/persons`
2. 班级管理API：`/api/classes`
3. 部门管理API：`/api/departments`

### B. 设计参考
1. Element Plus组件库：https://element-plus.org
2. Vue 3官方文档：https://vuejs.org
3. TypeScript官方文档：https://www.typescriptlang.org

### C. 开发工具
1. **代码编辑**：VS Code + Volar插件
2. **调试工具**：Vue DevTools
3. **API测试**：Postman或Insomnia
4. **性能分析**：Chrome DevTools

---

**文档版本**：1.1  
**最后更新**：2026-02-24  
**负责人**：前端开发团队  
**状态**：待实施