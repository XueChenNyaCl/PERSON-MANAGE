# 系统功能检查指南

## 1. 人员管理模块检查

### 1.1 API接口检查
- **人员列表获取**
  - 接口：GET /api/persons
  - 检查函数：`personApi.list()`
  - 预期结果：返回人员列表，包含name、type、email等字段

- **人员新增**
  - 接口：POST /api/persons
  - 检查函数：`personApi.create()`
  - 预期结果：成功创建新人员，返回创建后的人员信息

- **人员编辑**
  - 接口：PUT /api/persons/{id}
  - 检查函数：`personApi.update()`
  - 预期结果：成功更新人员信息，返回更新后的人员信息

- **人员删除**
  - 接口：DELETE /api/persons/{id}
  - 检查函数：`personApi.delete()`
  - 预期结果：成功删除人员，返回删除成功状态

### 1.2 前端功能检查
- **人员列表展示**：检查表格是否正确显示人员信息
- **新增人员表单**：检查表单验证和提交功能
- **编辑人员表单**：检查表单预填和更新功能
- **删除人员确认**：检查删除确认对话框和执行功能

## 2. 权限管理模块检查

### 2.1 API接口检查
- **权限列表获取**
  - 接口：GET /api/permissions
  - 检查函数：`permissionApi.list()`
  - 预期结果：返回权限列表

- **权限翻译键获取**
  - 接口：GET /api/permissions/translations
  - 检查函数：`permissionApi.getTranslations()`
  - 预期结果：返回权限翻译键映射

- **YAML模板导入**
  - 接口：POST /api/permissions/apply-yaml
  - 检查函数：`permissionApi.applyYaml()`
  - 预期结果：成功导入YAML模板，更新权限信息

- **用户权限更新**
  - 接口：PUT /api/permissions/users/{username}
  - 检查函数：`permissionApi.updateUserPermissions()`
  - 预期结果：成功更新用户权限，返回更新后的权限信息

### 2.2 前端功能检查
- **权限管理界面**：检查三栏布局是否正常显示
- **用户列表**：检查用户数据是否正确加载
- **用户权限展示**：检查用户现有权限是否正确显示
- **权限编辑**：检查添加/移除权限功能
- **YAML导入**：检查YAML文件上传和应用功能
- **权限翻译**：检查权限名称是否正确翻译显示

## 3. 前后端接口一致性检查

### 3.1 数据结构一致性
- 检查前端TypeScript类型定义与后端API响应结构是否一致
- 检查请求参数格式与后端接收格式是否一致
- 检查错误处理机制是否一致

### 3.2 接口路径一致性
- 检查前端API调用路径与后端路由定义是否一致
- 检查HTTP方法（GET/POST/PUT/DELETE）是否匹配
- 检查路径参数和查询参数是否正确传递

## 4. 数据库接口调用一致性检查

### 4.1 数据库操作检查
- 检查后端API是否正确调用数据库操作函数
- 检查SQL语句是否正确构建和执行
- 检查事务处理是否正确

### 4.2 数据完整性检查
- 检查数据插入是否完整
- 检查数据更新是否正确
- 检查数据删除是否彻底

## 5. 检查方法

### 5.1 前端检查方法
1. 打开浏览器开发者工具
2. 导航到对应功能页面
3. 执行操作（如点击按钮、提交表单等）
4. 在网络标签页检查API请求和响应
5. 检查控制台是否有错误信息
6. 验证页面显示是否符合预期

### 5.2 后端检查方法
1. 运行后端服务
2. 使用API测试工具（如Postman）发送请求
3. 检查响应状态码和数据
4. 查看后端日志是否有错误
5. 检查数据库数据是否正确更新

## 6. 检查结果记录

| 检查项 | 状态 | 问题描述 | 解决方案 |
|-------|------|---------|--------|
| 人员列表获取 | ✅ 通过 | 前端API客户端和后端路由都正确实现，接口路径一致 | 无需修改 |
| 人员新增 | ⚠️ 已修复 | 发现employee_no字段验证问题：前端验证未阻止空字符串提交，后端未检查空字符串。已修复前端验证规则和后端空字符串检查。 | 前端添加自定义验证器，后端添加非空检查。 |
| 人员编辑 | ✅ 通过 | 后端实现了完整的更新逻辑，支持所有人员类型的字段更新 | 无需修改 |
| 人员删除 | ✅ 通过 | 后端实现了删除功能，返回正确的状态码 | 无需修改 |
| 权限列表获取 | ✅ 通过 | 后端实现了获取角色和用户权限的功能 | 无需修改 |
| 权限翻译键获取 | ✅ 通过 | 后端实现了权限翻译功能，返回权限键的中文翻译 | 无需修改 |
| YAML模板导入 | ✅ 通过 | 后端实现了YAML模板应用功能，支持应用到用户、角色或所有用户 | 无需修改 |
| 用户权限更新 | ✅ 通过 | 后端实现了添加和移除用户权限的功能 | 无需修改 |
| 前后端接口一致性 | ✅ 通过 | 前端API路径与后端路由定义一致，数据结构匹配 | 无需修改 |
| 数据库接口调用 | ✅ 通过 | 后端正确使用SQLx进行数据库操作，实现了事务处理 | 无需修改 |
| 样式分离 | ✅ 通过 | 样式文件已正确分离到frontend/src/styles目录 | 无需修改 |

## 7. 常见问题及解决方案

1. **API 404错误**
   - 检查API路径是否正确
   - 检查后端服务是否运行
   - 检查路由配置是否正确

2. **数据加载失败**
   - 检查网络连接
   - 检查API响应格式
   - 检查前端数据处理逻辑

3. **权限更新失败**
   - 检查权限格式是否正确
   - 检查用户存在性
   - 检查后端权限处理逻辑

4. **YAML导入失败**
   - 检查YAML格式是否正确
   - 检查文件大小限制
   - 检查后端YAML解析逻辑

5. **人员创建时出现422错误**
   - 检查前端验证规则是否正确触发
   - 检查必填字段是否为空字符串（如employee_no、student_no）
   - 检查后端是否对空字符串进行了验证
   - 解决方案：在前端添加自定义验证器，在后端添加非空检查

## 8. 检查工具推荐

- **前端检查**：浏览器开发者工具、Vue DevTools
- **API测试**：Postman、curl
- **后端调试**：Rust日志、数据库客户端
- **性能检查**：Chrome Performance面板

## 9. 检查流程

1. 启动前后端服务
2. 按照检查项逐一测试
3. 记录检查结果
4. 解决发现的问题
5. 重新测试验证修复效果
6. 完成检查报告