use axum::{extract::State, Json}; use crate::api::routes::AppState; use crate::core::error::AppError; use serde::Serialize; #[derive(Debug, Serialize)] pub struct DebugPerson { pub id: Option<String>, pub name: String, pub type_: String, } pub async fn debug_persons( State(state): State<AppState>, ) -> Result<Json<Vec<DebugPerson>>, AppError> { let pool = state.pool.ok_or_else(|| AppError::Internal)?; let persons = sqlx::query!( r#"SELECT id::text as id, name, type as type_ FROM persons ORDER BY created_at DESC LIMIT 10"# ) .fetch_all(&pool) .await? .into_iter() .map(|row| DebugPerson { id: row.id, name: row.name, type_: row.type_, }) .collect(); Ok(Json(persons)) }